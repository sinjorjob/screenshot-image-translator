# 画像翻訳ツール 機能要件定義書

## 1. プロジェクト概要

### 1.1 目的
クリップボードにコピーされた画像内の日本語テキスト部分を自動的に英語に翻訳した画像を生成し、英語に翻訳された画像を表示する最小限の機能を持つツール。

### 1.2 スコープ
- **対象**: クリップボード内の画像のみ（画面キャプチャ機能は別途Windowsの標準機能を使用）
- **翻訳方向**: 日本語→英語のみ
- **利用者**: 社内の海外メンバー

## 2. 最小限の機能要件（MVP）

### 2.1 コア機能
#### 2.1.1 クリップボード監視
- **説明**: クリップボードの画像を自動検出して翻訳処理を開始
- **動作**:
  - アプリ起動時から自動的にクリップボード監視開始
  - 画像データ検出時に自動でAPI送信

#### 2.1.2 画像翻訳（GPT-Image-1 API）
- **説明**: 画像内の日本語テキストを英語に翻訳
- **動作**:
  - アスペクト比保持のための自動パディング処理
  - APIに最適化された画像を送信
  - 翻訳済み画像を受信
  - パディング除去・元サイズ復元処理
  - 品質設定（medium/high）と超精密モード対応

#### 2.1.3 設定外部化機能
- **説明**: config.jsonによる詳細設定管理
- **設定項目**:
  - API設定（品質、精度、タイムアウト、超精密モード）
  - 画像処理設定（パディング、背景色検出、最適化）
  - UI設定（監視間隔、通知、ウィンドウサイズ）
  - 出力設定（自動保存、保存先、ファイル名形式）
  - プロンプト設定（精度レベル、言語ペア）
  - デバッグ設定（ログレベル、詳細ログ）

#### 2.1.4 結果表示
- **説明**: 翻訳済み画像を新しいウィンドウで表示
- **動作**:
  - 翻訳完了後、自動的にウィンドウ表示
  - 「閉じる」ボタンのみ

#### 2.1.5 翻訳言語設定機能
- **説明**: 翻訳元（FROM）と翻訳先（TO）の言語を選択可能
- **対応言語**: 16言語
  - 日本語、英語、中国語簡体字、中国語繁体字、韓国語
  - **タガログ語**（フィリピンの公用語）
  - スペイン語、フランス語、ドイツ語、ポルトガル語
  - イタリア語、ロシア語、アラビア語、ヒンディー語
  - タイ語、ベトナム語
- **動作**:
  - システムトレイメニューから簡単設定
  - FROM言語とTO言語を個別に選択
  - 同一言語の選択を防止
  - 設定の永続化（config.jsonに自動保存）
  - 設定変更時の通知表示

#### 2.1.6 自動翻訳ON/OFF切り替え機能
- **説明**: 不要なAPI処理を防ぐための切り替え機能
- **動作**:
  - デフォルトはOFF状態（無課金状態）
  - システムトレイメニューで簡単切り替え
  - ON時は緑アイコン、OFF時はグレーアイコン
  - ON切り替え時に古いクリップボード画像は処理しない

#### 2.1.7 進捗表示機能
- **説明**: 翻訳処理の進捗をリアルタイム表示
- **動作**:
  - システムトレイ通知による進捗表示
  - 翻訳開始時に言語ペア表示
  - AI翻訳依頼中の状況表示（タイムアウト時間付き）
  - フォールバック処理の通知
  - エラー時の詳細通知とダイアログ表示

#### 2.1.8 自動保存機能
- **説明**: 翻訳結果の自動保存
- **動作**:
  - 設定に基づいてimagesフォルダに自動保存
  - タイムスタンプ付きファイル名
  - 元画像と翻訳後画像の両方を保存

### 2.2 最小限のUI
#### 2.2.1 システムトレイ（強化版）
- **説明**: 常駐アプリとして動作
- **メニュー**:
  - 「🔴 自動翻訳: OFF」/ 「🟢 自動翻訳: ON」（状態切り替え）
  - **「📝 翻訳設定」**（新機能）
    - 翻訳元言語 (From) ▶ 16言語から選択
    - 翻訳先言語 (To) ▶ 16言語から選択
    - 現在の設定表示（例：日本語 → タガログ語）
  - 「📸 画像表示テスト」（開発・テスト用機能）
  - 「終了」
- **アイコン**:
  - OFF時: グレーアイコン（OFF.png）
  - ON時: 緑アイコン（ON.png）

#### 2.2.2 結果表示ウィンドウ（強化版）
- **説明**: 翻訳済み画像を大画面で表示
- **機能**:
  - Ctrl+マウスホイールによる拡大縮小（0.1倍～5倍）
  - スクロール機能（拡大時の画像移動）
  - リアルタイムズーム表示（現在の倍率表示）
  - 大きな文字とボタンによる見やすいUI

## 3. 非機能要件

### 3.1 パフォーマンス
- **処理時間**: 10秒以内で翻訳完了

### 3.2 セキュリティ
- **APIキー**: 環境変数または設定ファイル（平文でOK）
- **通信**: HTTPS使用

### 3.3 動作環境
- **OS**: Windows 10/11
- **Python**: 3.12以上

## 4. 技術構成

### 4.1 使用技術
- **言語**: Python 3.9+
- **GUI**: PyQt5（システムトレイ、ウィンドウ表示）
- **画像処理**: Pillow
- **API通信**: requests

### 4.2 必要なパッケージ
```
PyQt5==5.15.9
Pillow==10.0.0
requests==2.31.0
python-dotenv==1.0.0  # APIキー管理用
```

### 4.3 プロジェクト構成
```
画像翻訳ツール/
├── README.md              # プロジェクト概要
├── requirements.txt       # Python依存パッケージ
├── .env                   # 環境変数（APIキー）
├── .env.example          # 環境変数テンプレート
├── config/               # 設定ファイル
│   └── config.json      # アプリケーション設定
├── source/              # ソースコード
│   ├── main.py         # メインプログラム
│   └── assets/         # 静的リソース
│       └── icons/      # アプリアイコン
│           ├── ON.png  # 自動翻訳ON時
│           └── OFF.png # 自動翻訳OFF時
├── images/              # 翻訳結果画像（自動生成）
├── logs/                # ログファイル（自動生成）
└── docs/               # ドキュメント
    ├── user_guide.md
    ├── functional_requirements.md
    ├── detailed_design.md
    └── config_guide.md
```

## 5. 制約と前提条件

### 5.1 制約
- 画像キャプチャ機能は実装しない（Windows標準のWin+Shift+S等を使用）
- **翻訳方向は16言語間で自由に選択可能**（従来：日本語→英語のみ）
- 品質設定は設定可能（medium: $0.04/枚、high: $0.17/枚）
- 超精密モード時は自動的にhigh品質を使用
- 包括的なエラー処理とログ記録機能
- **言語名の意味理解翻訳**（例：「日本語」→「wikang Hapon」）

### 5.2 前提条件
- OpenAI APIキーは事前に取得済み
- 社内利用のみ（GPLv3ライセンス問題なし）

## 6. 実装の流れ

1. **ユーザー操作**:
   - Windows標準ツールで画面キャプチャ（Win+Shift+S）
   - 範囲選択してクリップボードにコピー

2. **自動処理**:
   - ツールがクリップボードの画像を検出
   - GPT-Image-1 APIに送信
   - 翻訳結果を受信して表示

3. **結果確認**:
   - ウィンドウに翻訳済み画像が表示される
   - ユーザーが確認して閉じる

---

*作成日: 2025年1月16日*
*更新日: 2025年1月16日*
*バージョン: 1.0*